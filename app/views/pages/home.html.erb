<div id="header" class="text-center">
  <%= link_to "Log out", destroy_user_session_path, method: :delete, class: "" %>
</div>
<h1 class="text-center">EU XML notification genrator</h1>
<div class="text-center">
  <%= link_to "Lancer la création des XML", "", class: "c2a" %>
</div>
<h2 class="text-center">Comment ça marche?</h2>
<div>
  Le principe de fonctionnement est simple : cette application génère des fichiers XML, au format attendu par l'Union Européenne pour la notification de mise sur le marché de nouveaux produits. Ces fichiers sont constitués à partir des données présentes sur le FTP dédié (espace de stockage de fichier en ligne).
</div>
<h3 class="text-center">Le FTP</h3>
<div>
  <p>

    Le répertoire FTP est structuré de la façon suivante :<br>
    |- csvs<br>
      <span class="pdd-left-20px">|- countries</span><br>
      <span class="pdd-left-40px d-ib">|- <span class="t-i"><span class="t-u">countries.csv</span><span class="comment"> => onglet 'products_countries' du fichier 'datas_for_eu_xml.xlsx', enregistré au format CSV (1)</span></span></span><br>
      <span class="pdd-left-20px">|- emissions</span><br>
      <span class="pdd-left-40px d-ib">|- <span class="t-i"><span class="t-u">emissions.csv</span><span class="comment"> => onglet 'products_emissions' du fichier 'datas_for_eu_xml.xlsx', enregistré au format CSV (1)</span></span></span><br>
      <span class="pdd-left-20px">|- ingredients</span><br>
      <span class="pdd-left-40px d-ib">|- <span class="t-i"><span class="t-u">ingredients.csv</span><span class="comment"> => onglet 'products_ingredients' du fichier 'datas_for_eu_xml.xlsx', enregistré au format CSV (1)</span></span></span><br>
      <span class="pdd-left-20px">|- product_datas</span><br>
      <span class="pdd-left-40px d-ib">|- <span class="t-i"><span class="t-u">product_datas.csv</span><span class="comment"> => onglet 'products_datas' du fichier 'datas_for_eu_xml.xlsx', enregistré au format CSV (1)</span></span></span><br>
    |- sources_xmls<br>
      <span class="pdd-left-20px">|- emissions</span><br>
      <span class="pdd-left-40px d-ib">|- <span class="t-i"><span class="t-u">emissions_01.xml</span><span class="comment"> => 'banque' de blocs XML 'emission' : 1 bloc par cas number</span></span></span><br>
      <span class="pdd-left-20px">|- ingredients</span><br>
      <span class="pdd-left-40px d-ib">|- <span class="t-i"><span class="t-u">ingredients_01.xml</span><span class="comment"> => 'banque' de blocs XML 'ingredient' : 1 bloc par cas number</span></span></span><br>
      <span class="pdd-left-20px">|- presentations</span><br>
      <span class="pdd-left-40px d-ib">|- <span class="t-i"><span class="t-u">presentation-01.xml</span><span class="comment"> => bloc XML 'emission' : 1 seul blocdans le fichier</span></span></span><br>
      <span class="pdd-left-20px">|- <span class="t-i t-u">base.xml</span><span class="t-i comment"> => fichier XML servant de base à la création des XMLs pour chaque produit</span></span><br>
    |- target_xmls<br>
    |- <span class="t-i"><span class="t-u">datas_for_eu_xml.xlsx</span><span class="comment"> => fichier Excel permettant de saisir les valeurs particulières des produits</datas_for_eu_xml></span>
  </p>
  <p class="comment">(1) Le nom du fichier impote peu. Le dossier peut contenir plusiseurs fichiers : ils seront tous traités.</p>
</div>
<h3 class="text-center">datas_for_eu_xml.xlsx</h3>


<h3 class="text-center">Fonctionnement</h3>
<div>
  <p>L'application part d'une base pour générer les fichiers XML correspondant à chaque produit : cette base est contenue dans le fichier <span class="t-i t-u bg-lg">sources_xmls/base.xml</span>. Toutes les balises XML présentes dans ce fichier sont reprises telles quelles dans tous les fichiers générés, à l'exception des balises correspondant aux colonnes de l'onglet <span class="t-i bg-lg">product_datas</span> du fichier <span class="t-i bg-lg">datas_for_eu_xml.xlsx</span>. Celles-ci sont mises à jour en fonction des données saisies dans l'Excel.</p>
  <p>
    Ensuite, différents blocs <span class="t-i bg-lg">presentation, ingredient & emission</span> viennent compléter cette base :
    <ul>
      <li>le bloc <span class="t-i bg-lg">presentation</span> est récupéré à l'intérieur du dossier <span class="t-i bg-lg">sources_xmls/emissions</span>, à l'intérieur du fichier mentionné au niveau de la colonne <span class="t-i bg-lg">presentation_file_name</span> de l'onglet <span class="t-i bg-lg">product_datas</span> du fichier <span class="t-i t-u bg-lg">datas_for_eu_xlsx</span>. Les balises XML <span class="t-i bg-lg">LaunchDate, ProductNumber, Year</span> sont mises à jour en fonction des valeurs saisies dans les colonnes correspondantes de l'onglet <span class="t-i bg-lg">product_datas</span>. Le bloc est ensuite dupliqué pour chaque pays enregistrés pour le produit dans l'onglet <span class="t-i bg-lg">products_countries</span>, en modifiant à chaque duplication la valeur du <span class="t-i bg-lg">NationalMarket</span>.</li>
      <li>pour chaque ingredient du produit, le bloc <span class="t-i bg-lg">ingredient</span> correspondant au cas number est récupéré à l'intérieur du dossier <span class="t-i bg-lg">sources_xmls/ingredients</span>, à l'intérieur du fichier mentionné au niveau de la colonne <span class="t-i bg-lg">ingredients_file_name</span> de l'onglet <span class="t-i bg-lg">product_ingredients</span> du fichier <span class="t-i t-u bg-lg">datas_for_eu_xlsx</span>. Les balises XML correspondant aux colonnes de l'onglet <span class="t-i bg-lg">product_ingredients</span> sont mises à jour en fonction des valeurs saisies dans l'Excel.</li>
      <li>pour chaque emission du produit, le bloc <span class="t-i bg-lg">emission</span> correspondant au cas number est récupéré à l'intérieur du dossier <span class="t-i bg-lg">sources_xmls/emissions</span>, à l'intérieur du fichier mentionné au niveau de la colonne <span class="t-i bg-lg">emissions_file_name</span> de l'onglet <span class="t-i bg-lg">product_emissions</span> du fichier <span class="t-i t-u bg-lg">datas_for_eu_xlsx</span>. Les balises XML correspondant aux colonnes de l'onglet <span class="t-i bg-lg">product_emissions</span> sont mises à jour en fonction des valeurs saisies dans l'Excel.</span></li>
    </ul>
  </p>
</div>
